Make failed uninstalls roll back more reliably and better at avoiding naming conflicts.
